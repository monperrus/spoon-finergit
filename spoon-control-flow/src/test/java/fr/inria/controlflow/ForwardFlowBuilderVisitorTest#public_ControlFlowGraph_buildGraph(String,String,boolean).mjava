public
static
ControlFlowGraph
buildGraph
(
String
folder
,
final
String
methodName
,
boolean
simplify
)
throws
Exception
{
final
ControlFlowBuilder
visitor
=
new
ControlFlowBuilder
(
)
;
Factory
factory
=
new
SpoonMetaFactory
(
)
.
buildNewFactory
(
folder
,
5
)
;
ProcessingManager
pm
=
new
QueueProcessingManager
(
factory
)
;
pm
.
addProcessor
(
new
AbstractProcessor
<
CtMethod
>
(
)
{
@Override
public
void
process
(
CtMethod
element
)
{
if
(
element
.
getSimpleName
(
)
.
equals
(
methodName
)
)
{
visitor
.
build
(
element
)
;
}
}
}
)
;
pm
.
process
(
factory
.
getModel
(
)
.
getRootPackage
(
)
)
;
ControlFlowGraph
graph
=
visitor
.
getResult
(
)
;
if
(
simplify
)
graph
.
simplifyConvergenceNodes
(
)
;
System
.
out
.
println
(
graph
.
toGraphVisText
(
)
)
;
return
graph
;
}
