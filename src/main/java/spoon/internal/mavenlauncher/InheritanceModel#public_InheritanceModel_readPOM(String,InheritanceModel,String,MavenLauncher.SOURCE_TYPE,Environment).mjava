/** 
 * Extract the information from the pom
 * @param path the path to the pom
 * @param parent the parent pom
 * @return the extracted model
 * @throws IOException when the file does not exist
 * @throws XmlPullParserException when the file is corrupted
 */
public
static
InheritanceModel
readPOM
(
String
path
,
InheritanceModel
parent
,
String
m2RepositoryPath
,
MavenLauncher
.
SOURCE_TYPE
sourceType
,
Environment
environment
)
throws
IOException
,
XmlPullParserException
{
if
(
!
path
.
endsWith
(
".xml"
)
&&
!
path
.
endsWith
(
".pom"
)
)
{
path
=
Paths
.
get
(
path
,
"pom.xml"
)
.
toString
(
)
;
}
File
pomFile
=
new
File
(
path
)
;
if
(
!
pomFile
.
exists
(
)
)
{
return
null
;
}
MavenXpp3Reader
pomReader
=
new
MavenXpp3Reader
(
)
;
try
(
FileReader
reader
=
new
FileReader
(
pomFile
)
)
{
Model
model
=
pomReader
.
read
(
reader
)
;
InheritanceModel
inheritanceModel
=
new
InheritanceModel
(
model
,
parent
,
pomFile
.
getParentFile
(
)
,
m2RepositoryPath
,
sourceType
,
environment
)
;
for
(
String
module
:
model
.
getModules
(
)
)
{
if
(
path
.
contains
(
m2RepositoryPath
)
)
{
InheritanceModel
modulePom
=
readPOM
(
path
.
replaceAll
(
model
.
getArtifactId
(
)
,
module
)
,
inheritanceModel
,
m2RepositoryPath
,
sourceType
,
environment
)
;
if
(
modulePom
!=
null
)
{
inheritanceModel
.
addModule
(
modulePom
)
;
}
}
else
{
inheritanceModel
.
addModule
(
readPOM
(
Paths
.
get
(
pomFile
.
getParent
(
)
,
module
)
.
toString
(
)
,
inheritanceModel
,
m2RepositoryPath
,
sourceType
,
environment
)
)
;
}
}
return
inheritanceModel
;
}
}
