private
<
T
>
void
visitFieldAccess
(
CtFieldAccess
<
T
>
fieldAccess
)
{
if
(
"class"
.
equals
(
fieldAccess
.
getVariable
(
)
.
getSimpleName
(
)
)
)
{
Class
<
?
>
actualClass
=
fieldAccess
.
getVariable
(
)
.
getDeclaringType
(
)
.
getActualClass
(
)
;
if
(
actualClass
!=
null
)
{
CtLiteral
<
Class
<
?
>
>
literal
=
fieldAccess
.
getFactory
(
)
.
Core
(
)
.
createLiteral
(
)
;
literal
.
setValue
(
actualClass
)
;
setResult
(
literal
)
;
return
;
}
}
if
(
"length"
.
equals
(
fieldAccess
.
getVariable
(
)
.
getSimpleName
(
)
)
)
{
CtExpression
<
?
>
target
=
fieldAccess
.
getTarget
(
)
;
if
(
target
instanceof
CtNewArray
<
?
>
)
{
CtNewArray
<
?
>
newArr
=
(
CtNewArray
<
?
>
)
target
;
CtLiteral
<
Number
>
literal
=
fieldAccess
.
getFactory
(
)
.
createLiteral
(
newArr
.
getElements
(
)
.
size
(
)
)
;
setResult
(
literal
)
;
return
;
}
}
String
fieldName
=
fieldAccess
.
getVariable
(
)
.
getSimpleName
(
)
;
CtType
<
?
>
typeDeclaration
=
fieldAccess
.
getVariable
(
)
.
getDeclaringType
(
)
.
getTypeDeclaration
(
)
;
CtField
<
?
>
f
;
if
(
typeDeclaration
!=
null
)
{
f
=
typeDeclaration
.
getField
(
fieldName
)
;
}
else
{
f
=
fieldAccess
.
getVariable
(
)
.
getFieldDeclaration
(
)
;
}
if
(
(
f
!=
null
)
&&
f
.
getModifiers
(
)
.
contains
(
ModifierKind
.
FINAL
)
&&
!
fieldAccess
.
getVariable
(
)
.
getDeclaringType
(
)
.
isSubtypeOf
(
fieldAccess
.
getFactory
(
)
.
Type
(
)
.
ENUM
)
)
{
setResult
(
evaluate
(
f
.
getDefaultExpression
(
)
)
)
;
return
;
}
setResult
(
fieldAccess
.
clone
(
)
)
;
}
