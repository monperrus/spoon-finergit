public
<
T
>
void
visitCtInvocation
(
CtInvocation
<
T
>
invocation
)
{
CtInvocation
<
T
>
i
=
invocation
.
getFactory
(
)
.
Core
(
)
.
createInvocation
(
)
;
i
.
setExecutable
(
invocation
.
getExecutable
(
)
)
;
i
.
setTypeCasts
(
invocation
.
getTypeCasts
(
)
)
;
boolean
constant
=
true
;
i
.
setTarget
(
evaluate
(
invocation
.
getTarget
(
)
)
)
;
if
(
(
i
.
getTarget
(
)
!=
null
)
&&
!
(
i
.
getTarget
(
)
instanceof
CtLiteral
)
)
{
constant
=
false
;
}
for
(
CtExpression
<
?
>
e
:
invocation
.
getArguments
(
)
)
{
CtExpression
<
?
>
re
=
evaluate
(
e
)
;
if
(
!
(
re
instanceof
CtLiteral
)
)
{
constant
=
false
;
}
i
.
addArgument
(
re
)
;
}
if
(
i
.
getExecutable
(
)
.
getSimpleName
(
)
.
equals
(
CtExecutableReference
.
CONSTRUCTOR_NAME
)
)
{
setResult
(
i
)
;
return
;
}
if
(
constant
)
{
CtExecutable
<
?
>
executable
=
invocation
.
getExecutable
(
)
.
getDeclaration
(
)
;
CtType
<
?
>
aType
=
invocation
.
getParent
(
CtType
.
class
)
;
CtTypeReference
<
?
>
execDeclaringType
=
invocation
.
getExecutable
(
)
.
getDeclaringType
(
)
;
if
(
executable
!=
null
&&
aType
!=
null
&&
invocation
.
getType
(
)
!=
null
&&
execDeclaringType
!=
null
&&
execDeclaringType
.
isSubtypeOf
(
aType
.
getReference
(
)
)
)
{
CtBlock
<
?
>
b
=
evaluate
(
executable
.
getBody
(
)
)
;
flowEnded
=
false
;
CtStatement
last
=
b
.
getStatements
(
)
.
get
(
b
.
getStatements
(
)
.
size
(
)
-
1
)
;
if
(
(
last
instanceof
CtReturn
)
)
{
if
(
(
(
CtReturn
<
?
>
)
last
)
.
getReturnedExpression
(
)
instanceof
CtLiteral
)
{
setResult
(
(
(
CtReturn
<
?
>
)
last
)
.
getReturnedExpression
(
)
)
;
return
;
}
}
}
else
{
T
r
;
try
{
r
=
RtHelper
.
invoke
(
i
)
;
if
(
isLiteralType
(
r
)
)
{
CtLiteral
<
T
>
l
=
invocation
.
getFactory
(
)
.
Core
(
)
.
createLiteral
(
)
;
l
.
setValue
(
r
)
;
setResult
(
l
)
;
return
;
}
}
catch
(
Exception
e
)
{
}
}
}
setResult
(
i
)
;
}
