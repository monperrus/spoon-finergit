/** 
 * Run `code` in scope of `context`
 * @param context a to be entered `context`
 * @param code a to be processed {@link Runnable}
 */
private
void
runInContext
(
SourceFragmentContext
context
,
Runnable
code
)
{
sourceFragmentContextStack
.
push
(
context
)
;
try
{
code
.
run
(
)
;
}
finally
{
while
(
true
)
{
if
(
sourceFragmentContextStack
.
isEmpty
(
)
)
{
throw
new
SpoonException
(
"Inconsistent sourceFragmentContextStack"
)
;
}
SourceFragmentContext
c
=
sourceFragmentContextStack
.
pop
(
)
;
c
.
onFinished
(
)
;
if
(
c
==
context
)
{
break
;
}
}
}
}
