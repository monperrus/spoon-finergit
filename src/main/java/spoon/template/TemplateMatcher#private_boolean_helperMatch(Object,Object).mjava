private
boolean
helperMatch
(
Object
target
,
Object
template
)
{
if
(
(
target
==
null
)
&&
(
template
==
null
)
)
{
return
true
;
}
if
(
(
target
==
null
)
||
(
template
==
null
)
)
{
return
false
;
}
if
(
variables
.
contains
(
template
)
||
typeVariables
.
contains
(
template
)
)
{
boolean
add
=
invokeCallBack
(
target
,
template
)
;
if
(
add
)
{
return
addMatch
(
template
,
target
)
;
}
return
false
;
}
if
(
target
.
getClass
(
)
!=
template
.
getClass
(
)
)
{
return
false
;
}
if
(
(
template
instanceof
CtTypeReference
)
&&
template
.
equals
(
templateType
.
getReference
(
)
)
)
{
return
true
;
}
if
(
(
template
instanceof
CtPackageReference
)
&&
template
.
equals
(
templateType
.
getPackage
(
)
)
)
{
return
true
;
}
if
(
template
instanceof
CtReference
)
{
CtReference
tRef
=
(
CtReference
)
template
;
boolean
ok
=
matchNames
(
tRef
.
getSimpleName
(
)
,
(
(
CtReference
)
target
)
.
getSimpleName
(
)
)
;
if
(
ok
&&
!
template
.
equals
(
target
)
)
{
boolean
remove
=
!
invokeCallBack
(
target
,
template
)
;
if
(
remove
)
{
matches
.
remove
(
tRef
.
getSimpleName
(
)
)
;
return
false
;
}
return
true
;
}
}
if
(
template
instanceof
CtNamedElement
)
{
CtNamedElement
named
=
(
CtNamedElement
)
template
;
boolean
ok
=
matchNames
(
named
.
getSimpleName
(
)
,
(
(
CtNamedElement
)
target
)
.
getSimpleName
(
)
)
;
if
(
ok
&&
!
template
.
equals
(
target
)
)
{
boolean
remove
=
!
invokeCallBack
(
target
,
template
)
;
if
(
remove
)
{
matches
.
remove
(
named
.
getSimpleName
(
)
)
;
return
false
;
}
}
}
if
(
template
instanceof
Collection
)
{
return
matchCollections
(
(
Collection
<
?
>
)
target
,
(
Collection
<
?
>
)
template
)
;
}
if
(
template
instanceof
Map
)
{
if
(
template
.
equals
(
target
)
)
{
return
true
;
}
Map
<
?
,
?
>
temMap
=
(
Map
<
?
,
?
>
)
template
;
Map
<
?
,
?
>
tarMap
=
(
Map
<
?
,
?
>
)
target
;
if
(
!
temMap
.
keySet
(
)
.
equals
(
tarMap
.
keySet
(
)
)
)
{
return
false
;
}
return
matchCollections
(
tarMap
.
values
(
)
,
temMap
.
values
(
)
)
;
}
if
(
template
instanceof
CtBlock
<
?
>
)
{
final
List
<
CtStatement
>
statements
=
(
(
CtBlock
)
template
)
.
getStatements
(
)
;
if
(
statements
.
size
(
)
==
1
&&
statements
.
get
(
0
)
instanceof
CtInvocation
)
{
final
CtInvocation
ctStatement
=
(
CtInvocation
)
statements
.
get
(
0
)
;
if
(
"S"
.
equals
(
ctStatement
.
getExecutable
(
)
.
getSimpleName
(
)
)
&&
CtBlock
.
class
.
equals
(
ctStatement
.
getType
(
)
.
getActualClass
(
)
)
)
{
return
true
;
}
}
}
if
(
target
instanceof
CtElement
)
{
for
(
Field
f
:
RtHelper
.
getAllFields
(
target
.
getClass
(
)
)
)
{
f
.
setAccessible
(
true
)
;
if
(
Modifier
.
isStatic
(
f
.
getModifiers
(
)
)
)
{
continue
;
}
if
(
f
.
getName
(
)
.
equals
(
"parent"
)
)
{
continue
;
}
if
(
f
.
getName
(
)
.
equals
(
"position"
)
)
{
continue
;
}
if
(
f
.
getName
(
)
.
equals
(
"docComment"
)
)
{
continue
;
}
if
(
f
.
getName
(
)
.
equals
(
"factory"
)
)
{
continue
;
}
if
(
f
.
getName
(
)
.
equals
(
"comments"
)
)
{
continue
;
}
if
(
f
.
getName
(
)
.
equals
(
"metadata"
)
)
{
continue
;
}
try
{
if
(
!
helperMatch
(
f
.
get
(
target
)
,
f
.
get
(
template
)
)
)
{
return
false
;
}
}
catch
(
IllegalAccessException
ignore
)
{
}
}
return
true
;
}
else
if
(
target
instanceof
String
)
{
return
matchNames
(
(
String
)
template
,
(
String
)
target
)
;
}
else
{
return
target
.
equals
(
template
)
;
}
}
