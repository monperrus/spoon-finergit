@SuppressWarnings("unchecked")
private
boolean
matchCollections
(
Collection
<
?
>
target
,
Collection
<
?
>
template
)
{
final
List
<
Object
>
teList
=
new
ArrayList
<
>
(
template
)
;
final
List
<
Object
>
taList
=
new
ArrayList
<
>
(
target
)
;
CtElement
inMulti
=
nextListStatement
(
teList
,
null
)
;
List
<
Object
>
multi
=
new
ArrayList
<
>
(
)
;
if
(
null
==
inMulti
)
{
if
(
teList
.
size
(
)
!=
taList
.
size
(
)
)
{
return
false
;
}
for
(
int
te
=
0
,
ta
=
0
;
(
te
<
teList
.
size
(
)
)
&&
(
ta
<
taList
.
size
(
)
)
;
te
++
,
ta
++
)
{
if
(
!
helperMatch
(
taList
.
get
(
ta
)
,
teList
.
get
(
te
)
)
)
{
return
false
;
}
}
return
true
;
}
for
(
int
te
=
0
,
ta
=
0
;
(
te
<
teList
.
size
(
)
)
&&
(
ta
<
taList
.
size
(
)
)
;
te
++
,
ta
++
)
{
if
(
isCurrentTemplate
(
teList
.
get
(
te
)
,
inMulti
)
)
{
if
(
te
+
1
>=
teList
.
size
(
)
)
{
multi
.
addAll
(
taList
.
subList
(
te
,
taList
.
size
(
)
)
)
;
CtStatementList
tpl
=
templateType
.
getFactory
(
)
.
Core
(
)
.
createStatementList
(
)
;
tpl
.
setStatements
(
(
List
<
CtStatement
>
)
(
List
<
?
>
)
multi
)
;
if
(
!
invokeCallBack
(
tpl
,
inMulti
)
)
{
return
false
;
}
boolean
ret
=
addMatch
(
inMulti
,
multi
)
;
return
ret
;
}
te
++
;
while
(
(
te
<
teList
.
size
(
)
)
&&
(
ta
<
taList
.
size
(
)
)
&&
!
helperMatch
(
taList
.
get
(
ta
)
,
teList
.
get
(
te
)
)
)
{
multi
.
add
(
taList
.
get
(
ta
)
)
;
ta
++
;
}
CtStatementList
tpl
=
templateType
.
getFactory
(
)
.
Core
(
)
.
createStatementList
(
)
;
tpl
.
setStatements
(
(
List
<
CtStatement
>
)
(
List
<
?
>
)
multi
)
;
if
(
!
invokeCallBack
(
tpl
,
inMulti
)
)
{
return
false
;
}
addMatch
(
inMulti
,
tpl
)
;
inMulti
=
nextListStatement
(
teList
,
inMulti
)
;
multi
=
new
ArrayList
<
>
(
)
;
}
else
{
if
(
!
helperMatch
(
taList
.
get
(
ta
)
,
teList
.
get
(
te
)
)
)
{
return
false
;
}
if
(
!
(
ta
+
1
<
taList
.
size
(
)
)
&&
(
inMulti
!=
null
)
)
{
CtStatementList
tpl
=
templateType
.
getFactory
(
)
.
Core
(
)
.
createStatementList
(
)
;
for
(
Object
o
:
multi
)
{
tpl
.
addStatement
(
(
CtStatement
)
o
)
;
}
if
(
!
invokeCallBack
(
tpl
,
inMulti
)
)
{
return
false
;
}
addMatch
(
inMulti
,
tpl
)
;
inMulti
=
nextListStatement
(
teList
,
inMulti
)
;
multi
=
new
ArrayList
<
>
(
)
;
}
}
}
return
true
;
}
