@Override
public
<
T
>
void
visitCtMethod
(
CtMethod
<
T
>
element
)
{
if
(
!
element
.
getSimpleName
(
)
.
startsWith
(
"visitCt"
)
)
{
return
;
}
Factory
factory
=
element
.
getFactory
(
)
;
CtMethod
<
T
>
clone
=
element
.
clone
(
)
;
factory
.
Annotation
(
)
.
annotate
(
clone
,
Override
.
class
)
;
clone
.
getBody
(
)
.
getStatements
(
)
.
clear
(
)
;
for
(
int
i
=
1
;
i
<
element
.
getBody
(
)
.
getStatements
(
)
.
size
(
)
-
1
;
i
++
)
{
CtInvocation
inv
=
element
.
getBody
(
)
.
getStatement
(
i
)
;
List
<
CtExpression
<
?
>
>
invArgs
=
new
ArrayList
<
>
(
inv
.
getArguments
(
)
)
;
if
(
invArgs
.
size
(
)
<=
1
)
{
throw
new
RuntimeException
(
"You forget the role argument in line "
+
i
+
" of method "
+
element
.
getSimpleName
(
)
+
" from "
+
element
.
getDeclaringType
(
)
.
getQualifiedName
(
)
)
;
}
invArgs
.
remove
(
0
)
;
CtInvocation
getter
=
(
CtInvocation
)
invArgs
.
get
(
0
)
;
if
(
clone
.
getComments
(
)
.
size
(
)
==
0
)
{
final
CtComment
comment
=
factory
.
Core
(
)
.
createComment
(
)
;
comment
.
setCommentType
(
CtComment
.
CommentType
.
INLINE
)
;
comment
.
setContent
(
"auto-generated, see "
+
ReplacementVisitorGenerator
.
class
.
getName
(
)
)
;
clone
.
addComment
(
comment
)
;
}
Class
actualClass
=
getter
.
getType
(
)
.
getActualClass
(
)
;
CtInvocation
<
?
>
invocation
=
createInvocation
(
factory
,
element
,
invArgs
,
getter
,
actualClass
)
;
clone
.
getBody
(
)
.
addStatement
(
invocation
)
;
}
target
.
addMethod
(
clone
)
;
}
