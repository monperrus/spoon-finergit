@Test
public
void
testScannerCallsAllProperties
(
)
throws
Exception
{
final
Launcher
launcher
=
new
Launcher
(
)
;
launcher
.
addInputResource
(
"./src/main/java/spoon/reflect/"
)
;
launcher
.
run
(
)
;
CtClass
<
?
>
scanner
=
(
CtClass
<
?
>
)
launcher
.
getFactory
(
)
.
Type
(
)
.
get
(
CtScanner
.
class
)
;
for
(
CtType
<
?
>
t
:
SpoonTestHelpers
.
getAllInstantiableMetamodelInterfaces
(
)
)
{
Set
<
String
>
t1
=
new
TreeSet
<
>
(
)
;
for
(
CtMethod
<
?
>
m
:
t
.
getAllMethods
(
)
)
{
if
(
isMetamodelProperty
(
t
,
m
)
)
{
t1
.
add
(
computeSimpleSignature
(
m
)
)
;
}
}
Set
<
String
>
t2
=
new
TreeSet
<
>
(
)
;
CtMethod
<
?
>
visitMethod
=
scanner
.
getMethodsByName
(
"visit"
+
t
.
getSimpleName
(
)
)
.
get
(
0
)
;
for
(
CtInvocation
<
?
>
invoc
:
visitMethod
.
getElements
(
new
TypeFilter
<
CtInvocation
>
(
CtInvocation
.
class
)
{
@Override
public
boolean
matches
(
CtInvocation
element
)
{
CtMethod
<
?
>
method
=
(
CtMethod
<
?
>
)
element
.
getExecutable
(
)
.
getExecutableDeclaration
(
)
;
assertFalse
(
method
.
isShadow
(
)
)
;
return
super
.
matches
(
element
)
&&
isMetamodelProperty
(
t
,
method
)
;
}
}
)
)
{
t2
.
add
(
computeSimpleSignature
(
(
CtMethod
<
?
>
)
invoc
.
getExecutable
(
)
.
getExecutableDeclaration
(
)
)
)
;
}
assertEquals
(
"CtScanner contract violated for "
+
t
.
getSimpleName
(
)
,
t1
,
t2
)
;
}
}
