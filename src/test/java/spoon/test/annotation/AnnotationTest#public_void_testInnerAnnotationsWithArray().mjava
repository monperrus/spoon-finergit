@Test
public
void
testInnerAnnotationsWithArray
(
)
throws
Exception
{
final
CtClass
<
?
>
ctClass
=
(
CtClass
<
?
>
)
this
.
factory
.
Type
(
)
.
get
(
"spoon.test.annotation.testclasses.Foo"
)
;
final
CtMethod
<
?
>
testMethod
=
ctClass
.
getMethodsByName
(
"test"
)
.
get
(
0
)
;
final
List
<
CtAnnotation
<
?
Annotation
>
>
testMethodAnnotations
=
testMethod
.
getAnnotations
(
)
;
assertEquals
(
1
,
testMethodAnnotations
.
size
(
)
)
;
final
CtAnnotation
<
?
Annotation
>
firstAnnotation
=
testMethodAnnotations
.
get
(
0
)
;
assertEquals
(
OuterAnnotation
.
class
,
getActualClassFromAnnotation
(
firstAnnotation
)
)
;
final
CtNewArray
<
?
>
arrayAnnotations
=
(
CtNewArray
)
firstAnnotation
.
getElementValues
(
)
.
get
(
"value"
)
;
assertEquals
(
2
,
arrayAnnotations
.
getElements
(
)
.
size
(
)
)
;
final
CtAnnotation
<
?
>
firstAnnotationInArray
=
getMiddleAnnotation
(
arrayAnnotations
,
0
)
;
assertEquals
(
MiddleAnnotation
.
class
,
getActualClassFromAnnotation
(
firstAnnotationInArray
)
)
;
final
CtAnnotation
<
?
>
secondAnnotationInArray
=
getMiddleAnnotation
(
arrayAnnotations
,
1
)
;
assertEquals
(
MiddleAnnotation
.
class
,
getActualClassFromAnnotation
(
secondAnnotationInArray
)
)
;
final
CtAnnotation
<
?
>
innerAnnotationInFirstMiddleAnnotation
=
getInnerAnnotation
(
firstAnnotationInArray
)
;
assertEquals
(
InnerAnnotation
.
class
,
getActualClassFromAnnotation
(
innerAnnotationInFirstMiddleAnnotation
)
)
;
assertEquals
(
"hello"
,
getLiteralValueInAnnotation
(
innerAnnotationInFirstMiddleAnnotation
)
.
getValue
(
)
)
;
final
CtAnnotation
<
?
>
innerAnnotationInSecondMiddleAnnotation
=
getInnerAnnotation
(
secondAnnotationInArray
)
;
assertEquals
(
InnerAnnotation
.
class
,
getActualClassFromAnnotation
(
innerAnnotationInSecondMiddleAnnotation
)
)
;
assertEquals
(
"hello again"
,
getLiteralValueInAnnotation
(
innerAnnotationInSecondMiddleAnnotation
)
.
getValue
(
)
)
;
}
