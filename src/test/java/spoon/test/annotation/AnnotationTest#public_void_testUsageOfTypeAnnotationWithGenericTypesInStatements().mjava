@Test
public
void
testUsageOfTypeAnnotationWithGenericTypesInStatements
(
)
throws
Exception
{
final
CtClass
<
?
>
ctClass
=
(
CtClass
<
?
>
)
this
.
factory
.
Type
(
)
.
get
(
"spoon.test.annotation.testclasses.AnnotationsAppliedOnAnyTypeInAClass"
)
;
final
CtMethod
<
?
>
method
=
ctClass
.
getMethodsByName
(
"m4"
)
.
get
(
0
)
;
final
List
<
CtTypeReference
<
?
>
>
formalTypeParameters
=
method
.
getFormalTypeParameters
(
)
;
assertEquals
(
"Method has 1 generic parameter"
,
1
,
formalTypeParameters
.
size
(
)
)
;
assertEquals
(
"Method with an type annotation must be well printed"
,
"@spoon.test.annotation.testclasses.TypeAnnotation\nT"
,
formalTypeParameters
.
get
(
0
)
.
toString
(
)
)
;
final
CtBlock
<
?
>
body
=
method
.
getBody
(
)
;
final
String
expectedFirstStatement
=
"java.util.List<@spoon.test.annotation.testclasses.TypeAnnotation\nT> list = new java.util.ArrayList<@spoon.test.annotation.testclasses.TypeAnnotation\nT>()"
;
assertEquals
(
"Type annotation on generic parameter declared in the method"
,
expectedFirstStatement
,
body
.
getStatement
(
0
)
.
toString
(
)
)
;
final
String
expectedSecondStatement
=
"java.util.List<@spoon.test.annotation.testclasses.TypeAnnotation\n?> list2 = new java.util.ArrayList<java.lang.Object>()"
;
assertEquals
(
"Wildcard with an type annotation must be well printed"
,
expectedSecondStatement
,
body
.
getStatement
(
1
)
.
toString
(
)
)
;
final
String
expectedThirdStatement
=
"java.util.List<spoon.test.annotation.testclasses.@spoon.test.annotation.testclasses.TypeAnnotation BasicAnnotation> list3 = new java.util.ArrayList<spoon.test.annotation.testclasses.@spoon.test.annotation.testclasses.TypeAnnotation BasicAnnotation>()"
;
assertEquals
(
"Type in generic parameter with an type annotation must be well printed"
,
expectedThirdStatement
,
body
.
getStatement
(
2
)
.
toString
(
)
)
;
}
