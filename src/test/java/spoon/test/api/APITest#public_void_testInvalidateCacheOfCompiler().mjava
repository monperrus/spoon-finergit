@Test
public
void
testInvalidateCacheOfCompiler
(
)
throws
Exception
{
final
Launcher
spoon
=
new
Launcher
(
)
;
spoon
.
addInputResource
(
"./src/test/java/spoon/test/api/testclasses/Bar.java"
)
;
spoon
.
setSourceOutputDirectory
(
"./target/api"
)
;
spoon
.
getEnvironment
(
)
.
setNoClasspath
(
true
)
;
spoon
.
run
(
)
;
final
CtMethod
aMethod
=
spoon
.
getFactory
(
)
.
Core
(
)
.
createMethod
(
)
;
aMethod
.
setSimpleName
(
"foo"
)
;
aMethod
.
setType
(
spoon
.
getFactory
(
)
.
Type
(
)
.
BOOLEAN_PRIMITIVE
)
;
aMethod
.
setBody
(
spoon
.
getFactory
(
)
.
Core
(
)
.
createBlock
(
)
)
;
assertTrue
(
spoon
.
getModelBuilder
(
)
.
compile
(
)
)
;
final
CtClass
<
Bar
>
aClass
=
spoon
.
getFactory
(
)
.
Class
(
)
.
get
(
Bar
.
class
)
;
aClass
.
addMethod
(
aMethod
)
;
spoon
.
getModelBuilder
(
)
.
setShouldInvalidateCache
(
true
)
;
assertFalse
(
spoon
.
getModelBuilder
(
)
.
compile
(
)
)
;
aClass
.
removeMethod
(
aMethod
)
;
spoon
.
getModelBuilder
(
)
.
setShouldInvalidateCache
(
true
)
;
assertTrue
(
spoon
.
getModelBuilder
(
)
.
compile
(
)
)
;
}
