@Test
public
void
elementAnnotationRoleHandlerTest
(
)
{
Launcher
launcher
=
new
Launcher
(
)
;
Factory
factory
=
launcher
.
getFactory
(
)
;
CtClass
<
?
>
type
=
(
CtClass
)
factory
.
Core
(
)
.
create
(
CtClass
.
class
)
;
CtAnnotation
<
?
>
annotation
=
factory
.
Annotation
(
)
.
annotate
(
type
,
Parameter
.
class
,
"value"
,
"abc"
)
;
RoleHandler
roleHandler
=
RoleHandlerHelper
.
getRoleHandler
(
type
.
getClass
(
)
,
CtRole
.
ANNOTATION
)
;
assertNotNull
(
roleHandler
)
;
assertSame
(
CtElement
.
class
,
roleHandler
.
getTargetType
(
)
)
;
assertSame
(
CtRole
.
ANNOTATION
,
roleHandler
.
getRole
(
)
)
;
assertSame
(
ContainerKind
.
LIST
,
roleHandler
.
getContainerKind
(
)
)
;
assertSame
(
CtAnnotation
.
class
,
roleHandler
.
getValueClass
(
)
)
;
List
<
CtAnnotation
<
?
>
>
value
=
roleHandler
.
getValue
(
type
)
;
assertEquals
(
1
,
value
.
size
(
)
)
;
assertSame
(
annotation
,
value
.
get
(
0
)
)
;
try
{
value
.
remove
(
annotation
)
;
fail
(
)
;
}
catch
(
Exception
e
)
{
this
.
getClass
(
)
;
}
roleHandler
.
setValue
(
type
,
Collections
.
emptyList
(
)
)
;
value
=
roleHandler
.
getValue
(
type
)
;
assertEquals
(
0
,
value
.
size
(
)
)
;
roleHandler
.
setValue
(
type
,
Collections
.
singletonList
(
annotation
)
)
;
value
=
roleHandler
.
getValue
(
type
)
;
assertEquals
(
1
,
value
.
size
(
)
)
;
assertSame
(
annotation
,
value
.
get
(
0
)
)
;
try
{
roleHandler
.
setValue
(
type
,
annotation
)
;
fail
(
)
;
}
catch
(
ClassCastException
e
)
{
}
}
