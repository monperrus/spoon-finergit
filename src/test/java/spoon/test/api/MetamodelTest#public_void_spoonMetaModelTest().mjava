@Test
public
void
spoonMetaModelTest
(
)
{
SpoonMetaModel
mm
=
new
SpoonMetaModel
(
new
File
(
"./src/main/java"
)
)
;
List
<
String
>
problems
=
new
ArrayList
<
>
(
)
;
Set
<
CtRole
>
unhandledRoles
=
new
HashSet
<
>
(
Arrays
.
asList
(
CtRole
.
values
(
)
)
)
;
mm
.
getConcepts
(
)
.
forEach
(
mmConcept
->
{
mmConcept
.
getRoleToProperty
(
)
.
forEach
(
(
role
,
mmField
)
->
{
if
(
mmField
.
isUnsettable
(
)
)
{
assertTrue
(
"Unsettable field "
+
mmField
+
" must be derived too"
,
mmField
.
isDerived
(
)
)
;
}
unhandledRoles
.
remove
(
role
)
;
if
(
mmField
.
getMethod
(
MMMethodKind
.
GET
)
==
null
)
{
problems
.
add
(
"Missing getter for "
+
mmField
.
getOwnerConcept
(
)
.
getName
(
)
+
" and CtRole."
+
mmField
.
getRole
(
)
)
;
}
if
(
mmField
.
getMethod
(
MMMethodKind
.
SET
)
==
null
)
{
if
(
mmConcept
.
getTypeContext
(
)
.
isSubtypeOf
(
mm
.
getFactory
(
)
.
Type
(
)
.
createReference
(
CtReference
.
class
)
)
==
false
&&
mmConcept
.
getName
(
)
.
equals
(
"CtTypeInformation"
)
==
false
)
{
problems
.
add
(
"Missing setter for "
+
mmField
.
getOwnerConcept
(
)
.
getName
(
)
+
" and CtRole."
+
mmField
.
getRole
(
)
)
;
}
}
assertFalse
(
"Value type of Field "
+
mmField
.
toString
(
)
+
" is implicit"
,
mmField
.
getValueType
(
)
.
isImplicit
(
)
)
;
assertFalse
(
"Item value type of Field "
+
mmField
.
toString
(
)
+
" is implicit"
,
mmField
.
getItemValueType
(
)
.
isImplicit
(
)
)
;
mmField
.
forEachUnhandledMethod
(
ctMethod
->
problems
.
add
(
"Unhandled method signature: "
+
ctMethod
.
getDeclaringType
(
)
.
getSimpleName
(
)
+
"#"
+
ctMethod
.
getSignature
(
)
)
)
;
}
)
;
}
)
;
unhandledRoles
.
forEach
(
it
->
problems
.
add
(
"Unused CtRole."
+
it
.
name
(
)
)
)
;
}
