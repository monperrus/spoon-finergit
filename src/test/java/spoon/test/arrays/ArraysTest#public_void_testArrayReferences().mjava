@Test
public
void
testArrayReferences
(
)
throws
Exception
{
CtType
<
?
>
type
=
build
(
"spoon.test.arrays.testclasses"
,
"ArrayClass"
)
;
assertEquals
(
"ArrayClass"
,
type
.
getSimpleName
(
)
)
;
assertEquals
(
"int[][][]"
,
type
.
getField
(
"i"
)
.
getType
(
)
.
getSimpleName
(
)
)
;
assertEquals
(
3
,
(
(
CtArrayTypeReference
<
?
>
)
type
.
getField
(
"i"
)
.
getType
(
)
)
.
getDimensionCount
(
)
)
;
final
CtArrayTypeReference
<
?
>
arrayTypeReference
=
(
CtArrayTypeReference
<
?
>
)
type
.
getField
(
"i"
)
.
getDefaultExpression
(
)
.
getType
(
)
;
assertEquals
(
1
,
arrayTypeReference
.
getArrayType
(
)
.
getAnnotations
(
)
.
size
(
)
)
;
assertEquals
(
"@spoon.test.arrays.testclasses.ArrayClass.TypeAnnotation(integer = 1)"
,
arrayTypeReference
.
getArrayType
(
)
.
getAnnotations
(
)
.
get
(
0
)
.
toString
(
)
)
;
CtField
<
?
>
x
=
type
.
getField
(
"x"
)
;
CtArrayTypeReference
<
?
>
typeRef
=
(
CtArrayTypeReference
<
?
>
)
x
.
getType
(
)
;
assertTrue
(
typeRef
instanceof
CtArrayTypeReference
)
;
assertEquals
(
"int[]"
,
typeRef
.
getSimpleName
(
)
)
;
assertEquals
(
"int[]"
,
typeRef
.
getQualifiedName
(
)
)
;
assertEquals
(
"int"
,
typeRef
.
getComponentType
(
)
.
getSimpleName
(
)
)
;
assertTrue
(
(
(
CtArrayTypeReference
<
?
>
)
typeRef
)
.
getComponentType
(
)
.
getActualClass
(
)
.
equals
(
int
.
class
)
)
;
CtType
<
?
>
ctType
=
typeRef
.
getTypeDeclaration
(
)
;
assertEquals
(
"int[]"
,
ctType
.
getQualifiedName
(
)
)
;
assertTrue
(
typeRef
instanceof
CtArrayTypeReference
)
;
assertTrue
(
typeRef
.
getSimpleName
(
)
.
contains
(
"[]"
)
)
;
assertTrue
(
ctType
.
getSimpleName
(
)
.
contains
(
"[]"
)
)
;
assertTrue
(
x
.
getType
(
)
.
isSubtypeOf
(
x
.
getFactory
(
)
.
Type
(
)
.
get
(
Array
.
class
)
.
getReference
(
)
)
)
;
assertTrue
(
typeRef
.
getActualClass
(
)
.
getComponentType
(
)
!=
null
)
;
assertTrue
(
ctType
.
getActualClass
(
)
.
getComponentType
(
)
!=
null
)
;
assertTrue
(
typeRef
.
getComponentType
(
)
!=
null
)
;
assertEquals
(
"int"
,
typeRef
.
getComponentType
(
)
.
getSimpleName
(
)
)
;
assertSame
(
int
[
]
.
class
,
typeRef
.
getActualClass
(
)
)
;
assertEquals
(
int
[
]
.
class
,
ctType
.
getActualClass
(
)
)
;
assertEquals
(
int
.
class
,
ctType
.
getActualClass
(
)
.
getComponentType
(
)
)
;
assertEquals
(
"int[]"
,
ctType
.
getActualClass
(
)
.
getSimpleName
(
)
)
;
assertTrue
(
typeRef
.
isArray
(
)
)
;
assertTrue
(
ctType
.
isArray
(
)
)
;
assertFalse
(
type
.
isArray
(
)
)
;
assertFalse
(
type
.
getReference
(
)
.
isArray
(
)
)
;
}
