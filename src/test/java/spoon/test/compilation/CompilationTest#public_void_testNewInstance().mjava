@Test
public
void
testNewInstance
(
)
throws
Exception
{
Factory
factory
=
new
Launcher
(
)
.
getFactory
(
)
;
CtClass
<
Ifoo
>
c
=
factory
.
Code
(
)
.
createCodeSnippetStatement
(
"class X implements spoon.test.compilation.Ifoo { public int foo() {int i=0; return i;} }"
)
.
compile
(
)
;
c
.
addModifier
(
ModifierKind
.
PUBLIC
)
;
CtBlock
body
=
c
.
getElements
(
new
TypeFilter
<
>
(
CtBlock
.
class
)
)
.
get
(
1
)
;
Ifoo
o
=
c
.
newInstance
(
)
;
assertEquals
(
0
,
o
.
foo
(
)
)
;
for
(
int
i
=
1
;
i
<=
10
;
i
++
)
{
body
.
getStatement
(
0
)
.
replace
(
factory
.
Code
(
)
.
createCodeSnippetStatement
(
"int i = "
+
i
+
";"
)
)
;
o
=
c
.
newInstance
(
)
;
assertEquals
(
i
,
o
.
foo
(
)
)
;
}
}
