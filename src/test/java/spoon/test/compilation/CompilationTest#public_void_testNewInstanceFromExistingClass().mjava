@Test
public
void
testNewInstanceFromExistingClass
(
)
throws
Exception
{
CtClass
<
Bar
>
barCtType
=
(
CtClass
<
Bar
>
)
ModelUtils
.
buildClass
(
Bar
.
class
)
;
CtReturn
<
Integer
>
m
=
barCtType
.
getMethod
(
"m"
)
.
getBody
(
)
.
getStatement
(
0
)
;
IBar
bar
=
barCtType
.
newInstance
(
)
;
int
value
=
bar
.
m
(
)
;
assertEquals
(
1
,
value
)
;
m
.
setReturnedExpression
(
m
.
getFactory
(
)
.
Code
(
)
.
createLiteral
(
2
)
)
;
bar
=
barCtType
.
newInstance
(
)
;
value
=
bar
.
m
(
)
;
assertEquals
(
2
,
value
)
;
m
.
replace
(
m
.
getFactory
(
)
.
Code
(
)
.
createCodeSnippetStatement
(
"throw new FooEx()"
)
)
;
try
{
bar
=
barCtType
.
newInstance
(
)
;
value
=
bar
.
m
(
)
;
fail
(
)
;
}
catch
(
Exception
ignore
)
{
}
}
