@Test
public
void
testAddDeclaredTypeInCU
(
)
throws
IOException
{
File
resource
=
new
File
(
"./src/test/java/spoon/test/model/Foo.java"
)
;
final
Launcher
launcher
=
new
Launcher
(
)
;
launcher
.
setArgs
(
new
String
[
]
{
"--output-type"
,
"compilationunits"
}
)
;
launcher
.
addInputResource
(
resource
.
getPath
(
)
)
;
launcher
.
setSourceOutputDirectory
(
"./target/cu-onemoretype"
)
;
launcher
.
buildModel
(
)
;
CompilationUnit
cu
=
launcher
.
getFactory
(
)
.
CompilationUnit
(
)
.
getOrCreate
(
resource
.
getCanonicalPath
(
)
)
;
assertEquals
(
3
,
cu
.
getDeclaredTypes
(
)
.
size
(
)
)
;
CtType
typeBla
=
launcher
.
getFactory
(
)
.
Class
(
)
.
create
(
"spoon.test.model.Bla"
)
;
cu
.
addDeclaredType
(
typeBla
)
;
assertEquals
(
4
,
cu
.
getDeclaredTypes
(
)
.
size
(
)
)
;
launcher
.
prettyprint
(
)
;
File
output
=
new
File
(
"./target/cu-onemoretype/spoon/test/model/Foo.java"
)
;
List
<
String
>
lines
=
Files
.
readAllLines
(
output
.
toPath
(
)
)
;
String
fullContent
=
StringUtils
.
join
(
lines
,
"\n"
)
;
assertTrue
(
fullContent
.
contains
(
"public class Foo"
)
)
;
assertTrue
(
fullContent
.
contains
(
"class Bar"
)
)
;
assertTrue
(
fullContent
.
contains
(
"class Baz"
)
)
;
assertTrue
(
fullContent
.
contains
(
"class Bla"
)
)
;
}
