@Test
public
void
testDifferentEncodings
(
)
throws
Exception
{
final
Launcher
launcher
=
new
Launcher
(
)
;
launcher
.
addInputResource
(
"./src/test/resources/encodings/Cp1251.java"
)
;
launcher
.
addInputResource
(
"./src/test/resources/encodings/Utf8.java"
)
;
launcher
.
getEnvironment
(
)
.
setEncodingProvider
(
this
::
detectEncodingDummy
)
;
CtModel
model
=
launcher
.
buildModel
(
)
;
CtType
<
?
>
utf8Type
=
model
.
getAllTypes
(
)
.
stream
(
)
.
filter
(
t
->
"Utf8"
.
equals
(
t
.
getSimpleName
(
)
)
)
.
findFirst
(
)
.
get
(
)
;
CtType
<
?
>
cp1251Type
=
model
.
getAllTypes
(
)
.
stream
(
)
.
filter
(
t
->
"Cp1251"
.
equals
(
t
.
getSimpleName
(
)
)
)
.
findFirst
(
)
.
get
(
)
;
assertEquals
(
"\"Привет мир\""
,
utf8Type
.
getField
(
"s1"
)
.
getAssignment
(
)
.
toString
(
)
)
;
assertEquals
(
"\"Привет мир\""
,
cp1251Type
.
getField
(
"s1"
)
.
getAssignment
(
)
.
toString
(
)
)
;
assertEquals
(
utf8Type
.
getField
(
"s1"
)
,
cp1251Type
.
getField
(
"s1"
)
)
;
assertNotEquals
(
utf8Type
.
getField
(
"s2"
)
,
cp1251Type
.
getField
(
"s2"
)
)
;
}
