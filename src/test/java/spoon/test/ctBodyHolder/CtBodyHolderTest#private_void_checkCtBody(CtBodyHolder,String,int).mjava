private
void
checkCtBody
(
CtBodyHolder
p_bodyHolder
,
String
p_constant
,
int
off
)
{
CtStatement
body
=
p_bodyHolder
.
getBody
(
)
;
assertTrue
(
body
instanceof
CtBlock
<
?
>
)
;
CtBlock
<
?
>
block
=
(
CtBlock
)
body
;
assertEquals
(
1
+
off
,
block
.
getStatements
(
)
.
size
(
)
)
;
assertTrue
(
block
.
getStatement
(
off
)
instanceof
CtAssignment
)
;
CtAssignment
assignment
=
block
.
getStatement
(
off
)
;
assertEquals
(
p_constant
,
(
(
CtLiteral
<
String
>
)
assignment
.
getAssignment
(
)
.
partiallyEvaluate
(
)
)
.
getValue
(
)
)
;
Factory
f
=
body
.
getFactory
(
)
;
CtStatement
newStat
=
new
CWBStatementTemplate
(
"xx"
)
.
apply
(
body
.
getParent
(
CtType
.
class
)
)
;
try
{
newStat
.
getParent
(
)
;
fail
(
)
;
}
catch
(
ParentNotInitializedException
e
)
{
}
p_bodyHolder
.
setBody
(
newStat
)
;
CtBlock
newBlock
=
(
CtBlock
)
p_bodyHolder
.
getBody
(
)
;
assertSame
(
p_bodyHolder
,
newBlock
.
getParent
(
)
)
;
assertSame
(
newBlock
,
newStat
.
getParent
(
)
)
;
CtStatement
newStat2
=
newStat
.
clone
(
)
;
try
{
newStat2
.
getParent
(
)
;
fail
(
)
;
}
catch
(
ParentNotInitializedException
e
)
{
}
CtBlock
newBlock2
=
f
.
Code
(
)
.
createCtBlock
(
newStat2
)
;
assertSame
(
newBlock2
,
newStat2
.
getParent
(
)
)
;
try
{
newBlock2
.
getParent
(
)
;
fail
(
)
;
}
catch
(
ParentNotInitializedException
e
)
{
}
p_bodyHolder
.
setBody
(
newBlock2
)
;
assertSame
(
newBlock2
,
p_bodyHolder
.
getBody
(
)
)
;
assertSame
(
p_bodyHolder
,
newBlock2
.
getParent
(
)
)
;
assertSame
(
newBlock2
,
newStat2
.
getParent
(
)
)
;
}
