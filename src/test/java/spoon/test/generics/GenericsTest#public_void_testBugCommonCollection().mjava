@Test
public
void
testBugCommonCollection
(
)
throws
Exception
{
try
{
CtClass
<
?
>
type
=
build
(
"spoon.test.generics.testclasses3"
,
"BugCollection"
)
;
CtField
<
?
>
INSTANCE
=
type
.
getElements
(
new
NamedElementFilter
<
>
(
CtField
.
class
,
"INSTANCE"
)
)
.
get
(
0
)
;
assertEquals
(
"public static final spoon.test.generics.testclasses3.ACLass<?> INSTANCE = new spoon.test.generics.testclasses3.ACLass();"
,
INSTANCE
.
toString
(
)
)
;
CtField
<
?
>
INSTANCE2
=
type
.
getElements
(
new
NamedElementFilter
<
>
(
CtField
.
class
,
"INSTANCE2"
)
)
.
get
(
0
)
;
INSTANCE2
.
setAnnotations
(
new
ArrayList
<
>
(
)
)
;
assertEquals
(
"public static final spoon.test.generics.testclasses3.ACLass<?> INSTANCE2 = new spoon.test.generics.testclasses3.ACLass();"
,
INSTANCE2
.
toString
(
)
)
;
CtClass
<
?
>
ComparableComparator
=
type
.
getPackage
(
)
.
getElements
(
new
NamedElementFilter
<
>
(
CtClass
.
class
,
"ComparableComparator"
)
)
.
get
(
0
)
;
assertTrue
(
ComparableComparator
.
toString
(
)
.
startsWith
(
"class ComparableComparator<E extends java.lang.Comparable<? super E>>"
)
)
;
CtField
<
?
>
x
=
type
.
getElements
(
new
NamedElementFilter
<
>
(
CtField
.
class
,
"x"
)
)
.
get
(
0
)
;
CtTypeReference
<
?
>
ref
=
x
.
getType
(
)
;
assertEquals
(
"java.util.Map$Entry"
,
ref
.
getQualifiedName
(
)
)
;
assertEquals
(
"java.util.Map.Entry"
,
ref
.
toString
(
)
)
;
assertSame
(
java
.
util
.
Map
.
class
,
ref
.
getDeclaringType
(
)
.
getActualClass
(
)
)
;
CtField
<
?
>
y
=
type
.
getElements
(
new
NamedElementFilter
<
>
(
CtField
.
class
,
"y"
)
)
.
get
(
0
)
;
assertEquals
(
"java.util.Map.Entry<?, ?> y;"
,
y
.
toString
(
)
)
;
CtField
<
?
>
z
=
type
.
getElements
(
new
NamedElementFilter
<
>
(
CtField
.
class
,
"z"
)
)
.
get
(
0
)
;
assertEquals
(
"java.util.Map.Entry<java.lang.String, java.lang.Integer> z;"
,
z
.
toString
(
)
)
;
CtLocalVariable
<
?
>
lx
=
type
.
getElements
(
new
NamedElementFilter
<
>
(
CtLocalVariable
.
class
,
"lx"
)
)
.
get
(
0
)
;
assertEquals
(
"java.util.Map.Entry lx"
,
lx
.
toString
(
)
)
;
CtLocalVariable
<
?
>
ly
=
type
.
getElements
(
new
NamedElementFilter
<
>
(
CtLocalVariable
.
class
,
"ly"
)
)
.
get
(
0
)
;
assertEquals
(
"java.util.Map.Entry<?, ?> ly"
,
ly
.
toString
(
)
)
;
CtLocalVariable
<
?
>
lz
=
type
.
getElements
(
new
NamedElementFilter
<
>
(
CtLocalVariable
.
class
,
"lz"
)
)
.
get
(
0
)
;
assertEquals
(
"java.util.Map.Entry<java.lang.String, java.lang.Integer> lz"
,
lz
.
toString
(
)
)
;
CtLocalVariable
<
?
>
it
=
type
.
getElements
(
new
NamedElementFilter
<
>
(
CtLocalVariable
.
class
,
"it"
)
)
.
get
(
0
)
;
assertEquals
(
"java.util.Iterator<java.util.Map.Entry<?, ?>> it"
,
it
.
toString
(
)
)
;
}
catch
(
Exception
e
)
{
e
.
printStackTrace
(
)
;
throw
e
;
}
}
