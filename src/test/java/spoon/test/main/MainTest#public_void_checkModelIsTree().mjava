@Test
public
void
checkModelIsTree
(
)
{
Exception
dummyException
=
new
Exception
(
"STACK"
)
;
PrinterHelper
problems
=
new
PrinterHelper
(
rootPackage
.
getFactory
(
)
.
getEnvironment
(
)
)
;
Map
<
CtElement
,
Exception
>
allElements
=
new
IdentityHashMap
<
>
(
)
;
rootPackage
.
filterChildren
(
null
)
.
forEach
(
(
CtElement
ele
)
->
{
Exception
secondStack
=
dummyException
;
Exception
firstStack
=
allElements
.
put
(
ele
,
secondStack
)
;
if
(
firstStack
!=
null
)
{
if
(
firstStack
==
dummyException
)
{
fail
(
"The Spoon model is not a tree. The "
+
ele
.
getClass
(
)
.
getSimpleName
(
)
+
":"
+
ele
.
toString
(
)
+
" is shared"
)
;
}
problems
.
write
(
"The element "
+
ele
.
getClass
(
)
.
getSimpleName
(
)
)
.
writeln
(
)
.
incTab
(
)
.
write
(
ele
.
toString
(
)
)
.
writeln
(
)
.
write
(
"Is linked by these stacktraces"
)
.
writeln
(
)
.
write
(
"1) "
+
getStackTrace
(
firstStack
)
)
.
writeln
(
)
.
write
(
"2) "
+
getStackTrace
(
secondStack
)
)
.
writeln
(
)
.
decTab
(
)
;
}
}
)
;
String
report
=
problems
.
toString
(
)
;
if
(
!
report
.
isEmpty
(
)
)
{
fail
(
report
)
;
}
}
