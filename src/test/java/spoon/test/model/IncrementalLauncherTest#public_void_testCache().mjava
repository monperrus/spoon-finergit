@Test
public
void
testCache
(
)
throws
IOException
{
FileUtils
.
deleteDirectory
(
WORKING_DIR
)
;
FileUtils
.
copyDirectory
(
ORIGINAL_FILES_DIR
,
WORKING_DIR
)
;
Set
<
File
>
inputResources
=
Collections
.
singleton
(
WORKING_DIR
)
;
Set
<
String
>
sourceClasspath
=
Collections
.
emptySet
(
)
;
IncrementalLauncher
launcher1
=
new
IncrementalLauncher
(
inputResources
,
sourceClasspath
,
CACHE_DIR
)
;
assertTrue
(
launcher1
.
changesPresent
(
)
)
;
CtModel
originalModel
=
launcher1
.
buildModel
(
)
;
launcher1
.
saveCache
(
)
;
IncrementalLauncher
launcher2
=
new
IncrementalLauncher
(
inputResources
,
sourceClasspath
,
CACHE_DIR
)
;
assertFalse
(
launcher2
.
changesPresent
(
)
)
;
CtModel
cachedModel
=
launcher2
.
buildModel
(
)
;
launcher2
.
saveCache
(
)
;
assertTrue
(
originalModel
.
getAllTypes
(
)
.
equals
(
cachedModel
.
getAllTypes
(
)
)
)
;
IncrementalLauncher
launcher3
=
new
IncrementalLauncher
(
inputResources
,
sourceClasspath
,
CACHE_DIR
)
;
assertFalse
(
launcher3
.
changesPresent
(
)
)
;
CtModel
cachedCachedModel
=
launcher3
.
buildModel
(
)
;
launcher3
.
saveCache
(
)
;
assertTrue
(
originalModel
.
getAllTypes
(
)
.
equals
(
cachedCachedModel
.
getAllTypes
(
)
)
)
;
for
(
CtType
<
?
>
t
:
cachedCachedModel
.
getAllTypes
(
)
)
{
assertNotNull
(
t
.
getPosition
(
)
)
;
assertNotNull
(
t
.
getPosition
(
)
.
getFile
(
)
)
;
assertTrue
(
t
.
getPosition
(
)
.
getLine
(
)
!=
-
1
)
;
}
}
