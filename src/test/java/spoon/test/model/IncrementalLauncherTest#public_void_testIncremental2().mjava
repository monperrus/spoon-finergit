@Test
public
void
testIncremental2
(
)
throws
IOException
{
FileUtils
.
deleteDirectory
(
WORKING_DIR
)
;
FileUtils
.
copyDirectory
(
ORIGINAL_FILES_DIR
,
WORKING_DIR
)
;
Set
<
File
>
inputResources
=
new
HashSet
<
>
(
)
;
inputResources
.
add
(
new
File
(
WORKING_DIR
,
"A.java"
)
)
;
inputResources
.
add
(
new
File
(
WORKING_DIR
,
"B.java"
)
)
;
inputResources
.
add
(
new
File
(
WORKING_DIR
,
"C.java"
)
)
;
Set
<
String
>
sourceClasspath
=
Collections
.
emptySet
(
)
;
IncrementalLauncher
launcher1
=
new
IncrementalLauncher
(
inputResources
,
sourceClasspath
,
CACHE_DIR
)
;
assertTrue
(
launcher1
.
changesPresent
(
)
)
;
CtModel
originalModel
=
launcher1
.
buildModel
(
)
;
launcher1
.
saveCache
(
)
;
assertTrue
(
originalModel
.
getAllTypes
(
)
.
size
(
)
==
3
)
;
inputResources
.
removeIf
(
f
->
f
.
getName
(
)
.
equals
(
"C.java"
)
)
;
inputResources
.
add
(
new
File
(
WORKING_DIR
,
"D.java"
)
)
;
IncrementalLauncher
launcher2
=
new
IncrementalLauncher
(
inputResources
,
sourceClasspath
,
CACHE_DIR
)
;
assertTrue
(
launcher2
.
changesPresent
(
)
)
;
CtModel
newModel
=
launcher2
.
buildModel
(
)
;
launcher2
.
saveCache
(
)
;
assertTrue
(
newModel
.
getAllTypes
(
)
.
size
(
)
==
3
)
;
Collection
<
CtType
<
?
>
>
types1
=
originalModel
.
getAllTypes
(
)
;
Collection
<
CtType
<
?
>
>
types2
=
newModel
.
getAllTypes
(
)
;
CtType
<
?
>
a1
=
getTypeByName
(
types1
,
"A"
)
;
CtType
<
?
>
b1
=
getTypeByName
(
types1
,
"B"
)
;
CtType
<
?
>
c1
=
getTypeByName
(
types1
,
"C"
)
;
CtType
<
?
>
a2
=
getTypeByName
(
types2
,
"A"
)
;
CtType
<
?
>
b2
=
getTypeByName
(
types2
,
"B"
)
;
CtType
<
?
>
d2
=
getTypeByName
(
types2
,
"D"
)
;
assertTrue
(
a1
.
equals
(
a2
)
)
;
assertTrue
(
b1
.
equals
(
b2
)
)
;
assertFalse
(
c1
.
equals
(
d2
)
)
;
}
