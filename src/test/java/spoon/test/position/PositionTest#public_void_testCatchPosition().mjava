@Test
public
void
testCatchPosition
(
)
throws
Exception
{
final
CtType
<
?
>
foo
=
ModelUtils
.
buildClass
(
CatchPosition
.
class
)
;
String
classContent
=
getClassContent
(
foo
)
;
CtTry
tryStatement
=
(
CtTry
)
foo
.
getMethodsByName
(
"method"
)
.
get
(
0
)
.
getBody
(
)
.
getStatement
(
0
)
;
{
CtCatch
catcher
=
tryStatement
.
getCatchers
(
)
.
get
(
0
)
;
CtCatchVariable
<
?
>
catchVar
=
catcher
.
getParameter
(
)
;
BodyHolderSourcePosition
catcherPos
=
(
BodyHolderSourcePosition
)
catcher
.
getPosition
(
)
;
DeclarationSourcePosition
catchVarPos
=
(
DeclarationSourcePosition
)
catchVar
.
getPosition
(
)
;
assertEquals
(
" catch (final IOException e) {\n"
+
"			throw new RuntimeException(e);\n"
+
"		}"
,
contentAtPosition
(
classContent
,
catcherPos
.
getSourceStart
(
)
,
catcherPos
.
getSourceEnd
(
)
)
)
;
assertEquals
(
"final IOException e"
,
contentAtPosition
(
classContent
,
catchVarPos
.
getSourceStart
(
)
,
catchVarPos
.
getSourceEnd
(
)
)
)
;
assertEquals
(
""
,
contentAtPosition
(
classContent
,
catcherPos
.
getModifierSourceStart
(
)
,
catcherPos
.
getModifierSourceEnd
(
)
)
)
;
assertEquals
(
"final"
,
contentAtPosition
(
classContent
,
catchVarPos
.
getModifierSourceStart
(
)
,
catchVarPos
.
getModifierSourceEnd
(
)
)
)
;
assertEquals
(
" catch ("
,
contentAtPosition
(
classContent
,
catcherPos
.
getModifierSourceEnd
(
)
+
1
,
catcherPos
.
getNameStart
(
)
-
1
)
)
;
assertEquals
(
" IOException "
,
contentAtPosition
(
classContent
,
catchVarPos
.
getModifierSourceEnd
(
)
+
1
,
catchVarPos
.
getNameStart
(
)
-
1
)
)
;
assertEquals
(
"final IOException e"
,
contentAtPosition
(
classContent
,
catcherPos
.
getNameStart
(
)
,
catcherPos
.
getNameEnd
(
)
)
)
;
assertEquals
(
"e"
,
contentAtPosition
(
classContent
,
catchVarPos
.
getNameStart
(
)
,
catchVarPos
.
getNameEnd
(
)
)
)
;
assertEquals
(
"{\n"
+
"			throw new RuntimeException(e);\n"
+
"		}"
,
contentAtPosition
(
classContent
,
catcherPos
.
getBodyStart
(
)
,
catcherPos
.
getBodyEnd
(
)
)
)
;
}
{
CtCatch
catcher
=
tryStatement
.
getCatchers
(
)
.
get
(
1
)
;
BodyHolderSourcePosition
pos
=
(
BodyHolderSourcePosition
)
catcher
.
getPosition
(
)
;
assertEquals
(
" /*1*/ catch/*2*/ ( /*3*/ final @Deprecated /*4*/ ClassCastException /*5*/ e /*6*/) /*7*/ {\n"
+
"			throw new RuntimeException(e);\n"
+
"		}"
,
contentAtPosition
(
classContent
,
pos
.
getSourceStart
(
)
,
pos
.
getSourceEnd
(
)
)
)
;
assertEquals
(
""
,
contentAtPosition
(
classContent
,
pos
.
getModifierSourceStart
(
)
,
pos
.
getModifierSourceEnd
(
)
)
)
;
assertEquals
(
" /*3*/ final @Deprecated /*4*/ ClassCastException /*5*/ e"
,
contentAtPosition
(
classContent
,
pos
.
getNameStart
(
)
,
pos
.
getNameEnd
(
)
)
)
;
assertEquals
(
"{\n"
+
"			throw new RuntimeException(e);\n"
+
"		}"
,
contentAtPosition
(
classContent
,
pos
.
getBodyStart
(
)
,
pos
.
getBodyEnd
(
)
)
)
;
}
{
CtCatch
catcher
=
tryStatement
.
getCatchers
(
)
.
get
(
2
)
;
BodyHolderSourcePosition
pos
=
(
BodyHolderSourcePosition
)
catcher
.
getPosition
(
)
;
assertEquals
(
" catch /* ignore this catch */\n"
+
"		//and this catch too!\n"
+
"		( /**catch it ( */\n"
+
"				//catch (\n"
+
"				OutOfMemoryError|RuntimeException e) {\n"
+
"			throw new RuntimeException(e);\n"
+
"		}"
,
contentAtPosition
(
classContent
,
pos
.
getSourceStart
(
)
,
pos
.
getSourceEnd
(
)
)
)
;
assertEquals
(
""
,
contentAtPosition
(
classContent
,
pos
.
getModifierSourceStart
(
)
,
pos
.
getModifierSourceEnd
(
)
)
)
;
assertEquals
(
" /**catch it ( */\n"
+
"				//catch (\n"
+
"				OutOfMemoryError|RuntimeException e"
,
contentAtPosition
(
classContent
,
pos
.
getNameStart
(
)
,
pos
.
getNameEnd
(
)
)
)
;
assertEquals
(
"{\n"
+
"			throw new RuntimeException(e);\n"
+
"		}"
,
contentAtPosition
(
classContent
,
pos
.
getBodyStart
(
)
,
pos
.
getBodyEnd
(
)
)
)
;
}
}
