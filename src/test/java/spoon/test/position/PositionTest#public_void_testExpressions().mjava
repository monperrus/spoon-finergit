@Test
public
void
testExpressions
(
)
throws
Exception
{
final
CtType
<
?
>
foo
=
ModelUtils
.
buildClass
(
Expressions
.
class
)
;
String
classContent
=
getClassContent
(
foo
)
;
List
<
CtInvocation
<
?
>
>
statements
=
(
List
)
foo
.
getMethodsByName
(
"method"
)
.
get
(
0
)
.
getBody
(
)
.
getStatements
(
)
;
int
idx
=
0
;
assertEquals
(
"\"x\""
,
contentAtPosition
(
classContent
,
statements
.
get
(
idx
++
)
.
getArguments
(
)
.
get
(
0
)
.
getPosition
(
)
)
)
;
assertEquals
(
"(\"x\")"
,
contentAtPosition
(
classContent
,
statements
.
get
(
idx
++
)
.
getArguments
(
)
.
get
(
0
)
.
getPosition
(
)
)
)
;
assertEquals
(
"(String)null"
,
contentAtPosition
(
classContent
,
statements
.
get
(
idx
++
)
.
getArguments
(
)
.
get
(
0
)
.
getPosition
(
)
)
)
;
assertEquals
(
"( String) ( (Serializable)(( (null ))))"
,
contentAtPosition
(
classContent
,
statements
.
get
(
idx
++
)
.
getArguments
(
)
.
get
(
0
)
.
getPosition
(
)
)
)
;
assertEquals
(
"(((String) null))"
,
contentAtPosition
(
classContent
,
statements
.
get
(
idx
++
)
.
getArguments
(
)
.
get
(
0
)
.
getPosition
(
)
)
)
;
assertEquals
(
"( /*c2*/\n"
+
"				(\n"
+
"						/*c3*/  String\n"
+
"						/*c4*/) //c5\n"
+
"				null /*c6*/\n"
+
"				//c7\n"
+
"				)"
,
contentAtPosition
(
classContent
,
statements
.
get
(
idx
++
)
.
getArguments
(
)
.
get
(
0
)
.
getPosition
(
)
)
)
;
assertEquals
(
"(List<?>) null"
,
contentAtPosition
(
classContent
,
statements
.
get
(
idx
++
)
.
getArguments
(
)
.
get
(
0
)
.
getPosition
(
)
)
)
;
assertEquals
(
"(List<List<Map<String,Integer>>>) null"
,
contentAtPosition
(
classContent
,
statements
.
get
(
idx
++
)
.
getArguments
(
)
.
get
(
0
)
.
getPosition
(
)
)
)
;
{
CtExpression
<
?
>
expr
=
statements
.
get
(
1
)
.
getArguments
(
)
.
get
(
0
)
;
assertEquals
(
"(\"x\")"
,
contentAtPosition
(
classContent
,
expr
.
getPosition
(
)
)
)
;
assertFalse
(
expr
.
getPosition
(
)
instanceof
CompoundSourcePosition
)
;
}
{
CtExpression
<
?
>
expr
=
statements
.
get
(
3
)
.
getArguments
(
)
.
get
(
0
)
;
assertEquals
(
"( String) ( (Serializable)(( (null ))))"
,
contentAtPosition
(
classContent
,
expr
.
getPosition
(
)
)
)
;
assertTrue
(
expr
.
getPosition
(
)
instanceof
CompoundSourcePosition
)
;
assertEquals
(
"( String)"
,
contentAtPosition
(
classContent
,
expr
.
getTypeCasts
(
)
.
get
(
0
)
.
getPosition
(
)
)
)
;
assertEquals
(
"(Serializable)"
,
contentAtPosition
(
classContent
,
expr
.
getTypeCasts
(
)
.
get
(
1
)
.
getPosition
(
)
)
)
;
CompoundSourcePosition
compoundSourcePosition
=
(
CompoundSourcePosition
)
expr
.
getPosition
(
)
;
assertEquals
(
"(( (null )))"
,
contentAtPosition
(
classContent
,
compoundSourcePosition
.
getNameStart
(
)
,
compoundSourcePosition
.
getNameEnd
(
)
)
)
;
}
}
