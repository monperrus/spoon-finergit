@Test
public
void
testExactSourceFragments
(
)
throws
Exception
{
final
Launcher
launcher
=
new
Launcher
(
)
;
launcher
.
getEnvironment
(
)
.
setNoClasspath
(
false
)
;
launcher
.
getEnvironment
(
)
.
setCommentEnabled
(
true
)
;
SpoonModelBuilder
comp
=
launcher
.
createCompiler
(
)
;
comp
.
addInputSources
(
SpoonResourceHelper
.
resources
(
"./src/test/java/"
+
FooSourceFragments
.
class
.
getName
(
)
.
replace
(
'.'
,
'/'
)
+
".java"
)
)
;
comp
.
build
(
)
;
Factory
f
=
comp
.
getFactory
(
)
;
final
CtType
<
?
>
foo
=
f
.
Type
(
)
.
get
(
FooSourceFragments
.
class
)
;
checkElementFragments
(
foo
.
getMethodsByName
(
"m1"
)
.
get
(
0
)
.
getBody
(
)
.
getStatement
(
0
)
,
"if"
,
"("
,
"x > 0"
,
")"
,
"{this.getClass();}"
,
"else"
,
"{/*empty*/}"
)
;
checkElementFragments
(
foo
.
getMethodsByName
(
"m2"
)
.
get
(
0
)
.
getBody
(
)
.
getStatement
(
0
)
,
"/*c0*/"
,
" "
,
"if"
,
"  "
,
"/*c1*/"
,
"\t"
,
"("
,
" "
,
"//c2"
,
"\n\t\t\t\t"
,
"x > 0"
,
" "
,
"/*c3*/"
,
" "
,
")"
,
" "
,
"/*c4*/"
,
" "
,
"{ \n"
+
"			this.getClass();\n"
+
"		}"
,
" "
,
"/*c5*/ else /*c6*/ {\n"
+
"			/*empty*/\n"
+
"		}"
,
" "
,
"/*c7*/"
)
;
checkElementFragments
(
foo
.
getMethodsByName
(
"m3"
)
.
get
(
0
)
,
"/**\n"
+
"	 * c0\n"
+
"	 */"
,
group
(
"\n\t"
,
"public"
,
"\n\t"
,
"@Deprecated"
,
" "
,
"//c1 ends with tab and space\t "
,
"\n\t"
,
"static"
,
" "
)
,
"/*c2*/"
,
" "
,
"<"
,
group
(
"T"
,
","
,
" "
,
"U"
)
,
">"
,
" "
,
"T"
,
" "
,
"m3"
,
"("
,
group
(
"U param"
,
","
,
" "
,
"@Deprecated int p2"
)
,
")"
,
" "
,
"{\n"
+
"		return null;\n"
+
"	}"
)
;
checkElementFragments
(
foo
.
getMethodsByName
(
"m4"
)
.
get
(
0
)
.
getBody
(
)
.
getStatement
(
0
)
,
"label"
,
":"
,
" "
,
"while"
,
"("
,
"true"
,
")"
,
";"
)
;
checkElementFragments
(
foo
.
getMethodsByName
(
"m5"
)
.
get
(
0
)
.
getBody
(
)
.
getStatement
(
0
)
,
"f"
,
" "
,
"="
,
" "
,
"7.2"
,
";"
)
;
checkElementFragments
(
(
(
CtAssignment
)
foo
.
getMethodsByName
(
"m5"
)
.
get
(
0
)
.
getBody
(
)
.
getStatement
(
0
)
)
.
getAssignment
(
)
,
"7.2"
)
;
}
