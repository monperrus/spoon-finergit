@Test
public
void
consumerConstructorTest
(
)
throws
IOException
{
AtomicReferenceArray
<
Integer
>
atomicCounter
=
createCounter
(
)
;
new
FluentLauncher
(
)
.
inputResource
(
INPUT_FILES
)
.
processor
(
new
AbstractParallelProcessor
<
CtElement
>
(
(
e
)
->
atomicCounter
.
getAndUpdate
(
0
,
i
->
i
+
1
)
,
4
)
{
}
)
.
noClasspath
(
true
)
.
outputDirectory
(
folderFactory
.
newFolder
(
)
)
.
buildModel
(
)
;
AtomicInteger
singleThreadCounter
=
new
AtomicInteger
(
0
)
;
new
FluentLauncher
(
)
.
inputResource
(
INPUT_FILES
)
.
processor
(
new
AbstractProcessor
<
CtElement
>
(
)
{
@Override
public
void
process
(
CtElement
element
)
{
singleThreadCounter
.
incrementAndGet
(
)
;
}
}
)
.
noClasspath
(
true
)
.
outputDirectory
(
folderFactory
.
newFolder
(
)
)
.
buildModel
(
)
;
for
(
int
j
=
0
;
j
<
atomicCounter
.
length
(
)
;
j
++
)
{
singleThreadCounter
.
set
(
singleThreadCounter
.
get
(
)
-
atomicCounter
.
get
(
j
)
)
;
}
assertTrue
(
singleThreadCounter
.
get
(
)
==
0
)
;
}
