@Test
public
void
testStackOverflow
(
)
{
Launcher
launcher
=
new
Launcher
(
)
;
launcher
.
addInputResource
(
"./src/test/resources/noclasspath/elasticsearch-stackoverflow"
)
;
launcher
.
getEnvironment
(
)
.
setNoClasspath
(
true
)
;
launcher
.
buildModel
(
)
;
CtModel
model
=
launcher
.
getModel
(
)
;
Scanner
scanner
=
new
Scanner
(
)
;
scanner
.
scan
(
model
.
getRootPackage
(
)
)
;
List
<
CtExecutableReference
>
executables
=
launcher
.
getModel
(
)
.
getElements
(
new
TypeFilter
<
>
(
CtExecutableReference
.
class
)
)
;
assertFalse
(
executables
.
isEmpty
(
)
)
;
boolean
result
=
false
;
for
(
CtExecutableReference
execRef
:
executables
)
{
if
(
execRef
.
getSimpleName
(
)
.
equals
(
"setParentTask"
)
)
{
CtTypeReference
typeRef
=
execRef
.
getDeclaringType
(
)
;
assertTrue
(
typeRef
instanceof
CtTypeParameterReference
)
;
assertEquals
(
"ShardRequest"
,
typeRef
.
getSimpleName
(
)
)
;
CtType
typeRefDecl
=
typeRef
.
getDeclaration
(
)
;
assertEquals
(
"BroadcastShardRequest"
,
typeRefDecl
.
getSuperclass
(
)
.
getSimpleName
(
)
)
;
assertNull
(
execRef
.
getDeclaration
(
)
)
;
result
=
true
;
}
}
assertTrue
(
result
)
;
}
