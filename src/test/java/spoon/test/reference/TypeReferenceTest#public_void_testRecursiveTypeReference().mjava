@Test
public
void
testRecursiveTypeReference
(
)
throws
Exception
{
final
Launcher
launcher
=
new
Launcher
(
)
;
launcher
.
addInputResource
(
"./src/test/java/spoon/test/reference/testclasses/Tacos.java"
)
;
launcher
.
setSourceOutputDirectory
(
"./target/spoon-test"
)
;
launcher
.
run
(
)
;
final
CtInvocation
<
?
>
inv
=
Query
.
getElements
(
launcher
.
getFactory
(
)
,
new
TypeFilter
<
CtInvocation
<
?
>
>
(
CtInvocation
.
class
)
{
@Override
public
boolean
matches
(
CtInvocation
<
?
>
element
)
{
return
!
element
.
getExecutable
(
)
.
isConstructor
(
)
&&
super
.
matches
(
element
)
;
}
}
)
.
get
(
0
)
;
assertNotNull
(
inv
.
getExecutable
(
)
)
;
final
CtTypeReference
<
?
>
returnType
=
inv
.
getExecutable
(
)
.
getType
(
)
;
assertNotNull
(
returnType
)
;
assertEquals
(
1
,
returnType
.
getActualTypeArguments
(
)
.
size
(
)
)
;
final
CtTypeParameterReference
genericType
=
(
CtTypeParameterReference
)
returnType
.
getActualTypeArguments
(
)
.
get
(
0
)
;
assertNotNull
(
genericType
)
;
assertEquals
(
1
,
genericType
.
getBounds
(
)
.
size
(
)
)
;
final
CtTypeReference
<
?
>
extendsGeneric
=
genericType
.
getBounds
(
)
.
get
(
0
)
;
assertNotNull
(
extendsGeneric
)
;
assertEquals
(
1
,
extendsGeneric
.
getActualTypeArguments
(
)
.
size
(
)
)
;
final
CtTypeParameterReference
genericExtends
=
(
CtTypeParameterReference
)
extendsGeneric
.
getActualTypeArguments
(
)
.
get
(
0
)
;
assertNotNull
(
genericExtends
)
;
assertEquals
(
1
,
genericExtends
.
getBounds
(
)
.
size
(
)
)
;
final
CtTypeReference
<
?
>
circularRef
=
genericExtends
.
getBounds
(
)
.
get
(
0
)
;
assertTrue
(
circularRef
instanceof
CtCircularTypeReference
)
;
}
