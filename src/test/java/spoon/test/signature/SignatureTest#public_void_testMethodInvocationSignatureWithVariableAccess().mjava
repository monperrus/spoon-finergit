@Test
public
void
testMethodInvocationSignatureWithVariableAccess
(
)
throws
Exception
{
Factory
factory
=
new
FactoryImpl
(
new
DefaultCoreFactory
(
)
,
new
StandardEnvironment
(
)
)
;
factory
.
getEnvironment
(
)
.
setNoClasspath
(
true
)
;
String
content
=
""
+
"class PR {"
+
"static String PRS = null;"
+
"public Object foo(String p) {"
+
" int s = 0; 	"
+
" this.foo(s);"
+
"this.foo(p);"
+
" return null;"
+
"}"
+
" public Object foo(int p) {"
+
" String s = null;"
+
" this.foo(s);"
+
"this.foo(p);"
+
"return null;"
+
"}"
+
"};"
;
SpoonCompiler
builder
=
new
JDTSnippetCompiler
(
factory
,
content
)
;
builder
.
build
(
)
;
CtClass
<
?
>
clazz1
=
(
CtClass
<
?
>
)
factory
.
Type
(
)
.
getAll
(
)
.
get
(
0
)
;
assertNotNull
(
clazz1
)
;
CtMethod
<
?
>
methodString
=
(
CtMethod
<
?
>
)
clazz1
.
getAllMethods
(
)
.
toArray
(
)
[
0
]
;
CtInvocation
<
?
>
invoToInt1
=
(
CtInvocation
<
?
>
)
methodString
.
getBody
(
)
.
getStatement
(
1
)
;
String
signatureInvoToInt
=
invoToInt1
.
getSignature
(
)
;
CtExpression
<
?
>
argumentToInt1
=
invoToInt1
.
getArguments
(
)
.
get
(
0
)
;
CtMethod
<
?
>
methodInt
=
(
CtMethod
<
?
>
)
clazz1
.
getAllMethods
(
)
.
toArray
(
)
[
1
]
;
CtInvocation
<
?
>
invoToString
=
(
CtInvocation
<
?
>
)
methodInt
.
getBody
(
)
.
getStatement
(
1
)
;
CtExpression
<
?
>
argumentToString
=
invoToString
.
getArguments
(
)
.
get
(
0
)
;
String
signatureInvoToString
=
invoToString
.
getSignature
(
)
;
assertNotEquals
(
signatureInvoToInt
,
signatureInvoToString
)
;
String
sigArgToInt1
=
argumentToInt1
.
getSignature
(
)
;
String
sigArgToString1
=
argumentToString
.
getSignature
(
)
;
assertNotEquals
(
sigArgToInt1
,
sigArgToString1
)
;
CtInvocation
<
?
>
invoToString2
=
(
CtInvocation
<
?
>
)
methodString
.
getBody
(
)
.
getStatement
(
2
)
;
CtExpression
<
?
>
argumentToString2
=
invoToString2
.
getArguments
(
)
.
get
(
0
)
;
String
signatureInvoToString2
=
argumentToString2
.
getSignature
(
)
;
CtInvocation
<
?
>
invoToInt2
=
(
CtInvocation
<
?
>
)
methodInt
.
getBody
(
)
.
getStatement
(
2
)
;
CtExpression
<
?
>
argumentToInt2
=
invoToInt2
.
getArguments
(
)
.
get
(
0
)
;
String
signatureInvoToInt2
=
argumentToInt2
.
getSignature
(
)
;
String
sigParString
=
invoToString2
.
getSignature
(
)
;
String
sigParInteger
=
invoToInt2
.
getSignature
(
)
;
assertNotEquals
(
sigParString
,
sigParInteger
)
;
assertNotEquals
(
signatureInvoToString2
,
signatureInvoToInt2
)
;
}
