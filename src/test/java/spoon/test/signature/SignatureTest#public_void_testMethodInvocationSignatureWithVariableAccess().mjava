@Test
public
void
testMethodInvocationSignatureWithVariableAccess
(
)
{
Factory
factory
=
new
FactoryImpl
(
new
DefaultCoreFactory
(
)
,
new
StandardEnvironment
(
)
)
;
factory
.
getEnvironment
(
)
.
setNoClasspath
(
true
)
;
String
content
=
""
+
"class PR {"
+
"static String PRS = null;"
+
"public Object foo(String p) {"
+
" int s = 0; 	"
+
" this.foo(s);"
+
"this.foo(p);"
+
" return null;"
+
"}"
+
" public Object foo(int p) {"
+
" String s = null;"
+
" this.foo(s);"
+
"this.foo(p);"
+
"return null;"
+
"}"
+
"};"
;
SpoonModelBuilder
builder
=
new
JDTSnippetCompiler
(
factory
,
content
)
;
builder
.
build
(
)
;
CtClass
<
?
>
clazz1
=
(
CtClass
<
?
>
)
factory
.
Type
(
)
.
getAll
(
)
.
get
(
0
)
;
assertNotNull
(
clazz1
)
;
TreeSet
<
CtMethod
<
?
>
>
ts
=
new
TreeSet
<
>
(
new
DeepRepresentationComparator
(
)
)
;
ts
.
addAll
(
clazz1
.
getMethods
(
)
)
;
CtMethod
[
]
methodArray
=
ts
.
toArray
(
new
CtMethod
[
]
)
;
CtMethod
<
?
>
methodInteger
=
methodArray
[
0
]
;
assertEquals
(
"foo(int)"
,
methodInteger
.
getSignature
(
)
)
;
CtInvocation
<
?
>
invoToInt1
=
(
CtInvocation
<
?
>
)
methodInteger
.
getBody
(
)
.
getStatement
(
1
)
;
CtExpression
<
?
>
argumentToInt1
=
invoToInt1
.
getArguments
(
)
.
get
(
0
)
;
CtMethod
<
?
>
methodString
=
(
CtMethod
<
?
>
)
methodArray
[
1
]
;
assertEquals
(
"foo(java.lang.String)"
,
methodString
.
getSignature
(
)
)
;
CtInvocation
<
?
>
invoToString
=
(
CtInvocation
<
?
>
)
methodString
.
getBody
(
)
.
getStatement
(
1
)
;
CtExpression
<
?
>
argumentToString
=
invoToString
.
getArguments
(
)
.
get
(
0
)
;
assertNotEquals
(
invoToInt1
,
invoToString
)
;
assertNotEquals
(
argumentToInt1
,
argumentToString
)
;
CtInvocation
<
?
>
invoToString2
=
(
CtInvocation
<
?
>
)
methodInteger
.
getBody
(
)
.
getStatement
(
2
)
;
CtExpression
<
?
>
argumentToString2
=
invoToString2
.
getArguments
(
)
.
get
(
0
)
;
CtInvocation
<
?
>
invoToInt2
=
(
CtInvocation
<
?
>
)
methodString
.
getBody
(
)
.
getStatement
(
2
)
;
CtExpression
<
?
>
argumentToInt2
=
invoToInt2
.
getArguments
(
)
.
get
(
0
)
;
assertNotEquals
(
invoToString2
,
invoToInt2
)
;
assertNotEquals
(
argumentToString2
,
argumentToInt2
)
;
}
