@Test
public
void
testCompileAndReplaceSnippetsIn
(
)
{
final
Launcher
launcher
=
new
Launcher
(
)
;
launcher
.
addInputResource
(
"src/test/resources/snippet/SnippetResources.java"
)
;
launcher
.
buildModel
(
)
;
final
Factory
factory
=
launcher
.
getFactory
(
)
;
final
CtCodeSnippetStatement
codeSnippetStatement
=
factory
.
createCodeSnippetStatement
(
"s.method(23)"
)
;
final
CtClass
<
?
>
snippetClass
=
launcher
.
getFactory
(
)
.
Class
(
)
.
get
(
"snippet.test.resources.SnippetResources"
)
;
CtMethod
<
?
>
staticMethod
=
snippetClass
.
getMethodsByName
(
"staticMethod"
)
.
get
(
0
)
;
staticMethod
.
getBody
(
)
.
insertEnd
(
codeSnippetStatement
)
;
snippetClass
.
compileAndReplaceSnippets
(
)
;
assertSame
(
snippetClass
,
factory
.
Type
(
)
.
get
(
snippetClass
.
getQualifiedName
(
)
)
)
;
assertTrue
(
staticMethod
.
getBody
(
)
.
getLastStatement
(
)
instanceof
CtInvocation
<
?
>
)
;
final
CtInvocation
<
?
>
lastStatement
=
(
CtInvocation
<
?
>
)
staticMethod
.
getBody
(
)
.
getLastStatement
(
)
;
final
CtLocalVariableReference
<
?
>
reference
=
staticMethod
.
getElements
(
new
TypeFilter
<
>
(
CtLocalVariable
.
class
)
)
.
get
(
0
)
.
getReference
(
)
;
assertEquals
(
factory
.
createVariableRead
(
reference
,
false
)
,
lastStatement
.
getTarget
(
)
)
;
}
