@Test
public
void
testMatchGreedyMultiValueMinCount2
(
)
throws
Exception
{
CtType
<
?
>
ctClass
=
ModelUtils
.
buildClass
(
MatchMultiple2
.
class
)
;
for
(
int
i
=
0
;
i
<
7
;
i
++
)
{
final
int
count
=
i
;
CtType
<
?
>
type
=
ctClass
.
getFactory
(
)
.
Type
(
)
.
get
(
MatchMultiple2
.
class
)
;
Pattern
pattern
=
PatternBuilder
.
create
(
new
PatternBuilderHelper
(
type
)
.
setBodyOfMethod
(
"matcher1"
)
.
getPatternElements
(
)
)
.
configurePatternParameters
(
pb
->
{
pb
.
byTemplateParameter
(
)
;
pb
.
parameter
(
"statements1"
)
.
setContainerKind
(
ContainerKind
.
LIST
)
.
setMatchingStrategy
(
Quantifier
.
RELUCTANT
)
;
pb
.
parameter
(
"statements2"
)
.
setContainerKind
(
ContainerKind
.
LIST
)
.
setMatchingStrategy
(
Quantifier
.
GREEDY
)
.
setMaxOccurence
(
count
)
;
pb
.
parameter
(
"printedValue"
)
.
byVariable
(
"something"
)
.
matchInlinedStatements
(
)
;
pb
.
parameter
(
"printedValue"
)
.
setMatchingStrategy
(
Quantifier
.
GREEDY
)
.
setContainerKind
(
ContainerKind
.
LIST
)
.
setMinOccurence
(
2
)
;
}
)
.
build
(
)
;
List
<
Match
>
matches
=
pattern
.
getMatches
(
ctClass
.
getMethodsByName
(
"testMatch1"
)
.
get
(
0
)
.
getBody
(
)
)
;
if
(
count
<
7
)
{
assertEquals
(
"count="
+
count
,
1
,
matches
.
size
(
)
)
;
assertEquals
(
"count="
+
count
,
Math
.
max
(
0
,
3
-
count
)
,
getCollectionSize
(
matches
.
get
(
0
)
.
getParameters
(
)
.
getValue
(
"statements1"
)
)
)
;
assertEquals
(
"count="
+
count
,
count
-
Math
.
max
(
0
,
count
-
4
)
,
getCollectionSize
(
matches
.
get
(
0
)
.
getParameters
(
)
.
getValue
(
"statements2"
)
)
)
;
assertEquals
(
"count="
+
count
,
Math
.
max
(
2
,
3
-
Math
.
max
(
0
,
count
-
3
)
)
,
getCollectionSize
(
matches
.
get
(
0
)
.
getParameters
(
)
.
getValue
(
"printedValue"
)
)
)
;
}
else
{
assertEquals
(
"count="
+
count
,
0
,
matches
.
size
(
)
)
;
}
}
}
