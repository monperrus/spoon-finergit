@Test
public
void
testMatchPossesiveMultiValueMinCount
(
)
throws
Exception
{
CtType
<
?
>
ctClass
=
ModelUtils
.
buildClass
(
MatchMultiple3
.
class
)
;
for
(
int
count
=
0
;
count
<
6
;
count
++
)
{
final
int
countFinal
=
count
;
CtType
<
?
>
type
=
ctClass
.
getFactory
(
)
.
Type
(
)
.
get
(
MatchMultiple3
.
class
)
;
Pattern
pattern
=
PatternBuilder
.
create
(
new
PatternBuilderHelper
(
type
)
.
setBodyOfMethod
(
"matcher1"
)
.
getPatternElements
(
)
)
.
configurePatternParameters
(
)
.
configurePatternParameters
(
pb
->
{
pb
.
parameter
(
"statements1"
)
.
setContainerKind
(
ContainerKind
.
LIST
)
.
setMatchingStrategy
(
Quantifier
.
GREEDY
)
;
pb
.
parameter
(
"statements2"
)
.
setContainerKind
(
ContainerKind
.
LIST
)
.
setMatchingStrategy
(
Quantifier
.
POSSESSIVE
)
.
setMinOccurrence
(
countFinal
)
.
setMaxOccurrence
(
countFinal
)
;
pb
.
parameter
(
"printedValue"
)
.
byFilter
(
(
CtLiteral
<
?
>
literal
)
->
"something"
.
equals
(
literal
.
getValue
(
)
)
)
;
}
)
.
build
(
)
;
List
<
Match
>
matches
=
pattern
.
getMatches
(
ctClass
.
getMethodsByName
(
"testMatch1"
)
.
get
(
0
)
.
getBody
(
)
)
;
assertEquals
(
"count="
+
countFinal
,
countFinal
,
getCollectionSize
(
matches
.
get
(
0
)
.
getParameters
(
)
.
getValue
(
"statements2"
)
)
)
;
assertEquals
(
"count="
+
countFinal
,
5
-
countFinal
,
getCollectionSize
(
matches
.
get
(
0
)
.
getParameters
(
)
.
getValue
(
"statements1"
)
)
)
;
}
}
