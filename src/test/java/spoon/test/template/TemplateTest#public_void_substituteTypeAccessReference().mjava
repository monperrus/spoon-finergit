@Test
public
void
substituteTypeAccessReference
(
)
throws
Exception
{
Launcher
spoon
=
new
Launcher
(
)
;
spoon
.
addTemplateResource
(
new
FileSystemFile
(
"./src/test/java/spoon/test/template/testclasses/TypeReferenceClassAccessTemplate.java"
)
)
;
String
outputDir
=
"./target/spooned/test/template/testclasses"
;
spoon
.
setSourceOutputDirectory
(
outputDir
)
;
spoon
.
buildModel
(
)
;
Factory
factory
=
spoon
.
getFactory
(
)
;
CtTypeReference
<
?
>
typeRef
=
factory
.
Type
(
)
.
createReference
(
"spoon.test.template.TypeReferenceClassAccess$Example"
)
;
typeRef
.
addActualTypeArgument
(
factory
.
Type
(
)
.
DATE
)
;
final
CtClass
<
?
>
result
=
(
CtClass
<
?
>
)
new
TypeReferenceClassAccessTemplate
(
typeRef
)
.
apply
(
factory
.
Class
(
)
.
create
(
"spoon.test.template.TypeReferenceClassAccess"
)
)
;
spoon
.
prettyprint
(
)
;
ModelUtils
.
canBeBuilt
(
outputDir
,
8
)
;
CtMethod
<
?
>
method
=
result
.
getMethodsByName
(
"someMethod"
)
.
get
(
0
)
;
assertEquals
(
"spoon.test.template.TypeReferenceClassAccess.Example<java.util.Date>"
,
method
.
getType
(
)
.
toString
(
)
)
;
assertEquals
(
"spoon.test.template.TypeReferenceClassAccess.Example<java.util.Date>"
,
method
.
getParameters
(
)
.
get
(
0
)
.
getType
(
)
.
toString
(
)
)
;
assertEquals
(
"o = spoon.test.template.TypeReferenceClassAccess.Example.out"
,
method
.
getBody
(
)
.
getStatement
(
0
)
.
toString
(
)
)
;
assertEquals
(
"spoon.test.template.TypeReferenceClassAccess.Example<java.util.Date> ret = new spoon.test.template.TypeReferenceClassAccess.Example<java.util.Date>()"
,
method
.
getBody
(
)
.
getStatement
(
1
)
.
toString
(
)
)
;
assertEquals
(
"o = spoon.test.template.TypeReferenceClassAccess.Example.currentTimeMillis()"
,
method
.
getBody
(
)
.
getStatement
(
2
)
.
toString
(
)
)
;
assertEquals
(
"o = spoon.test.template.TypeReferenceClassAccess.Example.class"
,
method
.
getBody
(
)
.
getStatement
(
3
)
.
toString
(
)
)
;
assertEquals
(
"o = (o) instanceof spoon.test.template.TypeReferenceClassAccess.Example<?>"
,
method
.
getBody
(
)
.
getStatement
(
4
)
.
toString
(
)
)
;
assertEquals
(
"java.util.function.Supplier<java.lang.Long> p = spoon.test.template.TypeReferenceClassAccess.Example::currentTimeMillis"
,
method
.
getBody
(
)
.
getStatement
(
5
)
.
toString
(
)
)
;
}
