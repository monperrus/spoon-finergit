@Test
public
void
testTemplateMatcherWithWholePackage
(
)
throws
Exception
{
Launcher
spoon
=
new
Launcher
(
)
;
spoon
.
addInputResource
(
"./src/test/java/spoon/test/template/testclasses/ContextHelper.java"
)
;
spoon
.
addInputResource
(
"./src/test/java/spoon/test/template/testclasses/BServiceImpl.java"
)
;
spoon
.
addTemplateResource
(
new
FileSystemFile
(
"./src/test/java/spoon/test/template/testclasses/SecurityCheckerTemplate.java"
)
)
;
spoon
.
buildModel
(
)
;
Factory
factory
=
spoon
.
getFactory
(
)
;
CtClass
<
?
>
templateKlass
=
factory
.
Class
(
)
.
get
(
SecurityCheckerTemplate
.
class
)
;
CtMethod
templateMethod
=
(
CtMethod
)
templateKlass
.
getElements
(
new
NamedElementFilter
<
>
(
CtMethod
.
class
,
"matcher1"
)
)
.
get
(
0
)
;
CtIf
templateRoot
=
(
CtIf
)
templateMethod
.
getBody
(
)
.
getStatement
(
0
)
;
TemplateMatcher
matcher
=
new
TemplateMatcher
(
templateRoot
)
;
List
<
CtElement
>
matches
=
matcher
.
find
(
factory
.
getModel
(
)
.
getRootPackage
(
)
)
;
assertEquals
(
1
,
matches
.
size
(
)
)
;
CtElement
match
=
matches
.
get
(
0
)
;
assertTrue
(
"Match is not a if"
,
match
instanceof
CtIf
)
;
CtElement
matchParent
=
match
.
getParent
(
)
;
assertTrue
(
"Match parent is not a block"
,
matchParent
instanceof
CtBlock
)
;
CtElement
matchParentParent
=
matchParent
.
getParent
(
)
;
assertTrue
(
"Match grand parent is not a method"
,
matchParentParent
instanceof
CtMethod
)
;
CtMethod
methodHello
=
(
CtMethod
)
matchParentParent
;
assertEquals
(
"Match grand parent is not a method called hello"
,
"hello"
,
methodHello
.
getSimpleName
(
)
)
;
CtElement
methodParent
=
methodHello
.
getParent
(
)
;
assertTrue
(
"Parent of the method is not a class"
,
methodParent
instanceof
CtClass
)
;
CtClass
bservice
=
(
CtClass
)
methodParent
;
assertEquals
(
"Parent of the method is not a class called BServiceImpl"
,
"BServiceImpl"
,
bservice
.
getSimpleName
(
)
)
;
}
