@Test
public
void
testMergeOnDifferentValueTypeContainers
(
)
{
BiConsumer
<
ParameterInfo
,
ImmutableMap
>
checker
=
(
parameter
,
params
)
->
{
assertSame
(
params
,
parameter
.
addValueAs
(
params
,
"x"
)
)
;
assertNull
(
parameter
.
addValueAs
(
params
,
"y"
)
)
;
assertNull
(
parameter
.
addValueAs
(
params
,
null
)
)
;
}
;
ImmutableMap
empty
=
new
ImmutableMapImpl
(
)
;
checker
.
accept
(
new
MapParameterInfo
(
"year"
)
,
empty
.
putValue
(
"year"
,
"x"
)
)
;
checker
.
accept
(
new
ListParameterInfo
(
0
,
new
MapParameterInfo
(
"year"
)
)
,
empty
.
putValue
(
"year"
,
Collections
.
singletonList
(
"x"
)
)
)
;
checker
.
accept
(
new
ListParameterInfo
(
1
,
new
MapParameterInfo
(
"year"
)
)
,
empty
.
putValue
(
"year"
,
Arrays
.
asList
(
"zz"
,
"x"
)
)
)
;
checker
.
accept
(
new
MapParameterInfo
(
"key"
,
new
ListParameterInfo
(
1
,
new
MapParameterInfo
(
"year"
)
)
)
,
empty
.
putValue
(
"year"
,
Arrays
.
asList
(
"zz"
,
empty
.
putValue
(
"key"
,
"x"
)
)
)
)
;
checker
.
accept
(
new
MapParameterInfo
(
"key"
,
new
MapParameterInfo
(
"year"
)
)
,
empty
.
putValue
(
"year"
,
empty
.
putValue
(
"key"
,
"x"
)
)
)
;
}
