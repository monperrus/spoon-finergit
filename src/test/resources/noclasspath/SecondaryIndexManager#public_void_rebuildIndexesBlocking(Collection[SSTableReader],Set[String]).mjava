/** 
 * Does a full, blocking rebuild of the indexes specified by columns from the sstables. Caller must acquire and release references to the sstables used here. Note also that only this method of (re)building indexes: a) takes a set of index *names* rather than Indexers b) marks exsiting indexes removed prior to rebuilding
 * @param sstables the data to build from
 * @param indexNames the list of indexes to be rebuilt
 */
public
void
rebuildIndexesBlocking
(
Collection
<
SSTableReader
>
sstables
,
Set
<
String
>
indexNames
)
{
Set
<
Index
>
toRebuild
=
indexes
.
values
(
)
.
stream
(
)
.
filter
(
index
->
indexNames
.
contains
(
index
.
getIndexMetadata
(
)
.
name
)
)
.
filter
(
Index
::
shouldBuildBlocking
)
.
collect
(
Collectors
.
toSet
(
)
)
;
if
(
toRebuild
.
isEmpty
(
)
)
{
logger
.
info
(
"No defined indexes with the supplied names: {}"
,
Joiner
.
on
(
','
)
.
join
(
indexNames
)
)
;
return
;
}
toRebuild
.
forEach
(
indexer
->
markIndexRemoved
(
indexer
.
getIndexMetadata
(
)
.
name
)
)
;
buildIndexesBlocking
(
sstables
,
toRebuild
)
;
toRebuild
.
forEach
(
indexer
->
markIndexBuilt
(
indexer
.
getIndexMetadata
(
)
.
name
)
)
;
}
