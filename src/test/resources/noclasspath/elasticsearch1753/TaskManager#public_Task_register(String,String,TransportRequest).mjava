/** 
 * Registers a task without parent task <p> Returns the task manager tracked task or null if the task doesn't support the task manager
 */
public
Task
register
(
String
type
,
String
action
,
TransportRequest
request
)
{
Task
task
=
request
.
createTask
(
taskIdGenerator
.
incrementAndGet
(
)
,
type
,
action
,
request
.
getParentTask
(
)
)
;
if
(
task
==
null
)
{
return
null
;
}
assert
task
.
getParentTaskId
(
)
.
equals
(
request
.
getParentTask
(
)
)
:
"Request [ "
+
request
+
"] didn't preserve it parentTaskId"
;
if
(
logger
.
isTraceEnabled
(
)
)
{
logger
.
trace
(
"register {} [{}] [{}] [{}]"
,
task
.
getId
(
)
,
type
,
action
,
task
.
getDescription
(
)
)
;
}
if
(
task
instanceof
CancellableTask
)
{
registerCancellableTask
(
task
)
;
}
else
{
Task
previousTask
=
tasks
.
put
(
task
.
getId
(
)
,
task
)
;
assert
previousTask
==
null
:
;
}
return
task
;
}
