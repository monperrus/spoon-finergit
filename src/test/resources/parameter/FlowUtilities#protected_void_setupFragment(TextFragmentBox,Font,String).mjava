/** 
 * Sets up the fragment width based using the font and string passed in.
 * @param fragment the text fragment whose width will be set
 * @param font the font to be used in the calculation
 * @param string the string to be used in the calculation
 */
final
protected
void
setupFragment
(
TextFragmentBox
fragment
,
Font
font
,
String
string
)
{
if
(
fragment
.
getWidth
(
)
==
-
1
||
fragment
.
isTruncated
(
)
)
{
int
width
;
if
(
string
.
length
(
)
==
0
||
fragment
.
length
==
0
)
width
=
0
;
else
if
(
fragment
.
requiresBidi
(
)
)
{
width
=
getTextLayoutBounds
(
string
,
font
,
0
,
fragment
.
length
-
1
)
.
width
;
}
else
width
=
getTextUtilities
(
)
.
getStringExtents
(
string
.
substring
(
0
,
fragment
.
length
)
,
font
)
.
width
;
if
(
fragment
.
isTruncated
(
)
)
width
=
getEllipsisWidth
(
font
)
;
fragment
.
setWidth
(
width
)
;
}
}
